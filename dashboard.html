from IPython.display import HTML

HTML("""
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel de Triagem</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { background: #f4f8fb; font-family: "Poppins", sans-serif; }
    .card { border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
    h2 { color: #004b8d; margin-bottom: 20px; }
  </style>
</head>
<body class="p-4">
  <h2>ðŸ“Š Painel de Triagem</h2>

  <div class="row mb-4">
    <div class="col-md-4">
      <div class="card p-3">
        <h5>Total de Triagens</h5>
        <h2 id="totalTriagens">0</h2>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card p-3">
        <h5>MÃ©dia de Idade</h5>
        <h2 id="mediaIdade">0</h2>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card p-3">
        <h5>MÃ©dia de Dor</h5>
        <h2 id="mediaDor">0</h2>
      </div>
    </div>
  </div>

  <div class="card p-3 mb-4">
    <canvas id="graficoDor"></canvas>
  </div>

  <table class="table table-striped">
    <thead><tr><th>Nome</th><th>Idade</th><th>Dor</th><th>Queixa</th><th>FC</th><th>Temp</th></tr></thead>
    <tbody id="tabelaDados"></tbody>
  </table>

  <script>
    const sheetURL = "https://docs.google.com/spreadsheets/d/e/SEU_LINK_CSV/pub?output=csv";

    async function carregarDados() {
      const res = await fetch(sheetURL);
      const texto = await res.text();
      const linhas = texto.split("\\n").map(l => l.split(","));
      const dados = linhas.slice(1).filter(r => r[0]);

      document.getElementById("totalTriagens").textContent = dados.length;
      const idades = dados.map(r => parseInt(r[2] || 0)).filter(n => n);
      const dores = dados.map(r => parseInt(r[11] || 0)).filter(n => n);

      const mediaIdade = idades.reduce((a,b)=>a+b,0)/idades.length;
      const mediaDor = dores.reduce((a,b)=>a+b,0)/dores.length;

      document.getElementById("mediaIdade").textContent = Math.round(mediaIdade);
      document.getElementById("mediaDor").textContent = Math.round(mediaDor);

      const ctx = document.getElementById("graficoDor");
      const dist = dores.reduce((acc,v)=>{acc[v]=(acc[v]||0)+1;return acc;}, {});
      new Chart(ctx,{
        type:'bar',
        data:{labels:Object.keys(dist),datasets:[{label:'FrequÃªncia de dor',data:Object.values(dist),backgroundColor:'#007bff'}]},
        options:{plugins:{legend:{display:false}},scales:{y:{beginAtZero:true}}}
      });

      const tbody = document.getElementById("tabelaDados");
      dados.forEach(r=>{
        const row = `<tr><td>${r[1]}</td><td>${r[2]}</td><td>${r[11]}</td><td>${r[10]}</td><td>${r[6]}</td><td>${r[9]}</td></tr>`;
        tbody.innerHTML += row;
      });
    }

    carregarDados();
  </script>
</body>
</html>
""")
